<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.16-DEV" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Dev notes &middot; Dev notes </title>

  
  <link rel="stylesheet" href="https://dddpaul.github.io/blog/css/poole.css">
  <link rel="stylesheet" href="https://dddpaul.github.io/blog/css/syntax.css">
  <link rel="stylesheet" href="https://dddpaul.github.io/blog/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="https://dddpaul.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="Dev notes" />
</head>

<body>

<div class="sidebar">
    <div class="container sidebar-sticky">
        <div class="sidebar-about">
            <h1>Dev notes</h1>
            <p class="lead">
                 Notes about Android, Java, JavaScript, Go and other technical stuff 
            </p>
        </div>

        <ul class="sidebar-nav">
            <li><a href="/">Home</a> </li>
            
            <li><a href="http://github.com/dddpaul"> GitHub </a></li>
            
            <li><a href="http://google.com/&#43;PavelDerendyaev1"> Google&#43; </a></li>
            
            <li><a href="/blog/index.xml"> RSS </a></li>
            
        </ul>

        Tags:
        <ul>
            
            
            <li><a href="https://dddpaul.github.io/blog//tags/android/">android</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/angularjs/">angularjs</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/ansible/">ansible</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/concurrency/">concurrency</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/database/">database</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/devops/">devops</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/docker/">docker</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/git/">git</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/golang/">golang</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/hugo/">hugo</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/java/">java</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/javascript/">javascript</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/linux/">linux</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/python/">python</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/react/">react</a> </li>
            
            <li><a href="https://dddpaul.github.io/blog//tags/windows/">windows</a> </li>
            
        </ul>

        <p>&copy; 2016. All rights reserved. </p>
    </div>
</div>


<div class="content container">
    <div class="posts">

        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/11/13/mysql-to-postgresql-migration/">
                    MySQL to PostgreSQL migration
                </a>
            </h1>

            <span class="post-date">2016-11-13</span>

            <p>Install migration Ruby gem and run it:</p>

<pre><code>gem install mysql2psql
mysql2psql
</code></pre>

<p>Update database credentials in generated mysql2psql.yml file:</p>

<pre><code>mysql:
  database: redmine
  hostname: localhost
  port: 3306
  username: redmine
  password: xxxxxxx
  encoding: utf8

destination:
 # if file is given, output goes to file, else postgres
 file: /tmp/redmine-pg.sql
 postgres:
  hostname: localhost
  port: 5432
  username: mysql2psql
  password:
  database: mysql2psql_test
</code></pre>

<p>Run command again:</p>

<pre><code>mysql2psql
</code></pre>

<p>Links:</p>

<ul>
<li><a href="http://www.redmine.org/boards/2/topics/12825?r=41870">How to migrate from MySQL to PostgreSQL</a></li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/11/07/traefik-on-docker-swarm/">
                    Træfik on Docker Swarm mode cluster
                </a>
            </h1>

            <span class="post-date">2016-11-07</span>

            <p>Træfɪk is a modern HTTP reverse proxy and load balancer made to deploy microservices with ease. Since 1.1.0-rc1 it supports Docker Swarm mode as backend. It means that Træfɪk will automatically create proxying frontends which will be binded to corresponding Docker Swarm services.</p>

<p>This post is based on <a href="https://docs.traefik.io/user-guide/swarm-mode/">Docker Swarm (mode) cluster</a> example.</p>

<p>Assuming we have Docker Swarm mode cluster already, we will need to create an overlay network:</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">docker network create --driver<span class="o">=</span>overlay traefik-net
</code></pre></div>


<p>Backends are the simple <a href="https://github.com/emilevauge/whoamI">emilevauge/whoami</a> services:</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">docker service create --name test1 --label traefik.port<span class="o">=</span><span class="m">80</span> --network traefik-net emilevauge/whoami
docker service create --name test2 --label traefik.port<span class="o">=</span><span class="m">80</span> --network traefik-net emilevauge/whoami
</code></pre></div>


<p>Træfɪk itself may be ran in rich variety of configurations.</p>

<p><strong>1.</strong> HTTP only proxy</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">docker service create <span class="se">\</span>
--name traefik <span class="se">\</span>
--constraint<span class="o">=</span>node.role<span class="o">==</span>manager <span class="se">\</span>
--publish 80:80 --publish 8080:8080 <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock <span class="se">\</span>
--network traefik-net <span class="se">\</span>
traefik:v1.1.0-rc3 <span class="se">\</span>
--docker <span class="se">\</span>
--docker.swarmmode <span class="se">\</span>
--docker.domain<span class="o">=</span>example.org <span class="se">\</span>
--docker.watch <span class="se">\</span>
--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
--web
</code></pre></div>


<p>Remarks:</p>

<ul>
<li>Træfɪk web UI will we accessible on <a href="http://example.org:8080">http://example.org:8080</a>.</li>
<li>Debug log level must be disabled on production.</li>
</ul>

<p><strong>2.</strong> HTTPS proxy with Let&rsquo;s Encrypt certificate and HTTP to HTTPS redirection</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">docker service create <span class="se">\</span>
--name traefik <span class="se">\</span>
--constraint<span class="o">=</span>node.role<span class="o">==</span>manager <span class="se">\</span>
--publish 80:80 --publish 443:443 --publish 8080:8080 <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock,readonly <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/tmp,target<span class="o">=</span>/etc/traefik/acme <span class="se">\</span>
--network traefik-net <span class="se">\</span>
traefik:v1.1.0-rc3 <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:http Address::80 Redirect.EntryPoint:https&#39;</span> <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:https Address::443 TLS&#39;</span> <span class="se">\</span>
--defaultEntryPoints<span class="o">=</span>http,https <span class="se">\</span>
--acme.entryPoint<span class="o">=</span>https <span class="se">\</span>
--acme.email<span class="o">=</span>owner@example.org <span class="se">\</span>
--acme.storage<span class="o">=</span>/etc/traefik/acme/acme.json <span class="se">\</span>
--acme.domains<span class="o">=</span>example.org <span class="se">\</span>
--acme.onHostRule<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
--docker <span class="se">\</span>
--docker.swarmmode <span class="se">\</span>
--docker.domain<span class="o">=</span>example.org <span class="se">\</span>
--docker.watch <span class="se">\</span>
--web
</code></pre></div>
</p>

<p><strong>3.</strong> HTTPS-only proxy with Let&rsquo;s Encrypt certificate</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">docker service create <span class="se">\</span>
--name traefik <span class="se">\</span>
--constraint<span class="o">=</span>node.role<span class="o">==</span>manager <span class="se">\</span>
--publish 443:443 --publish 8080:8080 <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock,readonly <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/tmp,target<span class="o">=</span>/etc/traefik/acme <span class="se">\</span>
--network traefik-net <span class="se">\</span>
traefik:v1.1.0-rc3 <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:https Address::443 TLS&#39;</span> <span class="se">\</span>
--defaultEntryPoints<span class="o">=</span>https <span class="se">\</span>
--acme.entryPoint<span class="o">=</span>https <span class="se">\</span>
--acme.email<span class="o">=</span>owner@example.org <span class="se">\</span>
--acme.storage<span class="o">=</span>/etc/traefik/acme/acme.json <span class="se">\</span>
--acme.domains<span class="o">=</span>example.org <span class="se">\</span>
--acme.onHostRule<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
--docker <span class="se">\</span>
--docker.swarmmode <span class="se">\</span>
--docker.domain<span class="o">=</span>example.org <span class="se">\</span>
--docker.watch <span class="se">\</span>
--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
--web
</code></pre></div>
</p>

<p><strong>4.</strong> HTTPS-only proxy with Let&rsquo;s Encrypt certificate and HTTPS web UI</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">docker service create <span class="se">\</span>
--name traefik <span class="se">\</span>
--constraint<span class="o">=</span>node.role<span class="o">==</span>manager <span class="se">\</span>
--publish 443:443 --publish 8443:8443 <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock,readonly <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/etc/pki/realms/domain,target<span class="o">=</span>/etc/traefik/tls,readonly <span class="se">\</span>
--mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/var/tmp,target<span class="o">=</span>/etc/traefik/acme <span class="se">\</span>
--network traefik-net <span class="se">\</span>
traefik:v1.1.0-rc3 <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:https Address::443 TLS:/etc/traefik/tls/default.crt,/etc/traefik/tls/default.key&#39;</span> <span class="se">\</span>
--defaultEntryPoints<span class="o">=</span>https <span class="se">\</span>
--acme.entryPoint<span class="o">=</span>https <span class="se">\</span>
--acme.email<span class="o">=</span>owner@example.org <span class="se">\</span>
--acme.storage<span class="o">=</span>/etc/traefik/acme/acme.json <span class="se">\</span>
--acme.domains<span class="o">=</span>example.org <span class="se">\</span>
--acme.onHostRule<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
--docker <span class="se">\</span>
--docker.swarmmode <span class="se">\</span>
--docker.domain<span class="o">=</span>example.org <span class="se">\</span>
--docker.watch <span class="se">\</span>
--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
--web.address<span class="o">=</span>:8443 <span class="se">\</span>
--web.certfile<span class="o">=</span>/etc/traefik/tls/default.crt <span class="se">\</span>
--web.keyfile<span class="o">=</span>/etc/traefik/tls/default.key
</code></pre></div>
</p>

<p><strong>5.</strong> For debugging purposes you can run Træfɪk without Docker</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">traefik -d <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:http Address::8080 Redirect.EntryPoint:https&#39;</span> <span class="se">\</span>
--entryPoints<span class="o">=</span><span class="s1">&#39;Name:https Address::8443 TLS&#39;</span> <span class="se">\</span>
--defaultEntryPoints<span class="o">=</span>http,https <span class="se">\</span>
--acme.entryPoint<span class="o">=</span>https <span class="se">\</span>
--acme.email<span class="o">=</span>owner@example.org <span class="se">\</span>
--acme.storage<span class="o">=</span>acme.json <span class="se">\</span>
--acme.domains<span class="o">=</span>example.org
--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
--web
</code></pre></div>
</p>

<p>Links:</p>

<ul>
<li><a href="https://traefik.io/">Træfɪk</a></li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/11/02/docker-registry/">
                    Docker registry on Centos 7
                </a>
            </h1>

            <span class="post-date">2016-11-02</span>

            <p><strong>1.</strong> Create logical volumes for <code>direct-lvm</code> production mode</p>

<p>Official <a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/">Device Mapper storage driver guide</a> recommends to use <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Logical_Volume_Manager_Administration/thinprovisioned_volumes.html">thin pools</a> now. But we will follow more simple way :)</p>

<p>Assume that we have 40 GByte block device named as <code>/dev/sdb</code> with one full-size Linux partition on it.</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">pvcreate /dev/sdb1                 <span class="c1"># Create physical volume</span>
vgcreate docker /dev/sdb1          <span class="c1"># Create volume group and add this physical volume to it</span>
lvcreate -L 2G -n metadata docker  <span class="c1"># Create logical volume for Docker metadata</span>
lvcreate -L 15G -n data docker     <span class="c1"># Create logical volume for Docker data (layers, containers etc)</span>
lvcreate -L 15G -n registry docker <span class="c1"># Create logical volume for Docker Registry data</span>
</code></pre></div>


<p>Mount volume for Docker registry:</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">mkfs.xfs /dev/docker/registry
<span class="nb">echo</span> <span class="s2">&quot;/dev/docker/registry /var/lib/docker-registry    xfs     defaults        1 3&quot;</span> &gt;&gt; /etc/fstab 
mount -a
</code></pre></div>


<p>Check:</p>

<pre><code>lsblk
NAME                             MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda                                8:0    0   120G  0 disk
├─sda1                             8:1    0   876M  0 part /boot
└─sda2                             8:2    0 119,1G  0 part
  ├─centos-swap                  253:0    0     2G  0 lvm  [SWAP]
  └─centos-root                  253:1    0 117,2G  0 lvm  /
sdb                                8:16   0    40G  0 disk
└─sdb1                             8:17   0    40G  0 part
  ├─docker-metadata              253:2    0     2G  0 lvm
  │ └─docker-253:1-23762136-pool 253:5    0    15G  0 dm
  ├─docker-data                  253:3    0    15G  0 lvm
  │ └─docker-253:1-23762136-pool 253:5    0    15G  0 dm
  └─docker-registry              253:4    0    15G  0 lvm  /var/lib/docker-registry
</code></pre>

<p><strong>2.</strong> Configure Docker daemon</p>

<p>Create systemd drop-in file:</p>

<div class="highlight"><pre><code class="language-shell" data-lang="shell">mkdir -p /etc/systemd/system/docker.service.d
cat &gt; /etc/systemd/system/docker.service.d/env.conf 
<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">EnvironmentFile</span><span class="o">=</span>-/etc/sysconfig/docker
<span class="nv">ExecStart</span><span class="o">=</span>
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/dockerd $OPTIONS <span class="nv">$D</span>OCKER_NETWORK_OPTIONS <span class="nv">$D</span>OCKER_STORAGE_OPTIONS
</code></pre></div>


<p>Specify Docker configuration:</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">cat &gt; /etc/sysconfig/docker 
<span class="nv">OPTIONS</span><span class="o">=</span><span class="s1">&#39;--iptables=false&#39;</span>
<span class="nv">DOCKER_NETWORK_OPTIONS</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="nv">DOCKER_STORAGE_OPTIONS</span><span class="o">=</span><span class="s1">&#39;--storage-driver=devicemapper --storage-opt dm.datadev=/dev/docker/data --storage-opt dm.metadatadev=/dev/docker/metadata&#39;</span>
</code></pre></div>
</p>

<p>Check:</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">systemctl daemon-reload
systemctl show docker <span class="p">|</span> grep EnvironmentFile
<span class="nv">EnvironmentFile</span><span class="o">=</span>/etc/sysconfig/docker <span class="o">(</span><span class="nv">ignore_errors</span><span class="o">=</span>yes<span class="o">)</span>
</code></pre></div>
</p>

<p>And run:</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">systemctl <span class="nb">enable</span> docker
systemctl restart docker
</code></pre></div>
</p>

<p>Check again:</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">docker info <span class="p">|</span> grep data
 Data file: /dev/docker/data
 Metadata file: /dev/docker/metadata
 Metadata Space Used: <span class="m">639</span> kB
 Metadata Space Total: 2.147 GB
 Metadata Space Available: 2.147 GB
</code></pre></div>
</p>

<p><strong>3.</strong> Obtain SSL certificate from Let&rsquo;s Encrypt</p>

<p>It&rsquo;s can be done by different ways, see <a href="https://dddpaul.github.io/blog/2016/10/20/lego-nginx/">Let&rsquo;s Encrypt with lego and Nginx</a> for one of these.</p>

<p>Assume that certificate and key was obtained and stored in <code>/etc/pki/tls/lego/certificates</code> directory.</p>

<p><strong>4.</strong> Run Docker registry container as systemd unit</p>

<p>Create systemd unit:</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">cat &gt; /etc/systemd/system/docker-registry.service
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Docker registry container
<span class="nv">Requires</span><span class="o">=</span>docker.service
<span class="nv">After</span><span class="o">=</span>docker.service

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Restart</span><span class="o">=</span>always
<span class="nv">ExecStartPre</span><span class="o">=</span>/usr/bin/docker create -p 5000:5000 -v /var/lib/docker-registry:/var/lib/registry -v /etc/pki/tls/lego/certificates:/certs -e <span class="nv">REGISTRY_HTTP_TLS_CERTIFICATE</span><span class="o">=</span>/certs/example.org.crt -e <span class="nv">REGISTRY_HTTP_TLS_KEY</span><span class="o">=</span>/certs/example.org.key --name registry registry:2
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/docker start -a registry
<span class="nv">ExecStop</span><span class="o">=</span>/usr/bin/docker stop -t <span class="m">5</span> registry
<span class="nv">ExecStopPost</span><span class="o">=</span>/usr/bin/docker rm registry

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
</p>

<p><strong>5.</strong> Permit access to Docker registry only from trusted networks</p>

<p><div class="highlight"><pre><code class="language-shell" data-lang="shell">firewall-cmd --zone<span class="o">=</span>trusted --add-port<span class="o">=</span>5000/tcp --permanent
firewall-cmd --zone<span class="o">=</span>trusted --add-source<span class="o">=</span>192.168.1.0/24 --permanent
firewall-cmd --reload
</code></pre></div>
</p>

<p>Since Docker daemon was launched with <code>--iptables=false</code> option, Docker registry port may be accessed from trusted networks only.</p>

<p>Links:</p>

<ul>
<li><a href="https://docs.docker.com/engine/admin/systemd/">Control and configure Docker with systemd</a></li>
<li><a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/">Docker and the Device Mapper storage driver</a></li>
<li><a href="http://trainingdevops.com/insights-and-tutorials/deploying-docker-registry-with-let-s-encrypt-ssl-tls-certs">Deploying Docker Registry with Let&rsquo;s Encrypt SSL/TLS Certs</a></li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/10/20/lego-nginx/">
                    Let&#39;s Encrypt with lego and Nginx
                </a>
            </h1>

            <span class="post-date">2016-10-20</span>

            <p><a href="https://github.com/xenolf/lego">xenolf/lego</a> it&rsquo;s a feature-rich Let&rsquo;s Encrypt client and ACME library written in Go.</p>

<p><strong>1.</strong> Prepare Nginx server</p>

<pre><code>server {
    listen 80 default;
    server_name example.org www.example.org;

    location /.well-known/acme-challenge {
        proxy_pass http://127.0.0.1:81;
        proxy_set_header Host $host;
    }

    # Other directives
}
</code></pre>

<p><strong>2.</strong> Update ca-certificates for CentOS 5 (optional)</p>

<p>Let&rsquo;s Encrypt CA certificate is not included into root CA bundle of old Linux distributions like RHEL/Centos 5. You have to replace this bundle manually with fresh one from <a href="http://curl.haxx.se/">cURL website</a>:</p>

<pre><code>cp /etc/pki/tls/certs/ca-bundle.crt /etc/pki/tls/certs/ca-bundle.crt.bak
wget -O /etc/pki/tls/certs/ca-bundle.crt http://curl.haxx.se/ca/cacert.pem
</code></pre>

<p><strong>3.</strong> Order the certificate from Let&rsquo;s Encrypt</p>

<pre><code>lego -d example.org -d www.example.org -m cert-owner@example.org -a --path=/etc/pki/tls/lego --http=:81 run
</code></pre>

<p><strong>4.</strong> Update Nginx server</p>

<pre><code>server {
    listen 80 default;
    server_name example.org www.example.org;

    location /.well-known/acme-challenge {
        proxy_pass http://127.0.0.1:81;
        proxy_set_header Host $host;
    }

    # Other directives
}

server {
    listen 443 ssl;
    server_name example.org www.example.org;

    ssl_certificate /etc/pki/tls/lego/certificates/example.org.crt;
    ssl_certificate_key /etc/pki/tls/lego/certificates/example.org.key;

    location /.well-known/acme-challenge {
        proxy_pass http://127.0.0.1:444;
        proxy_set_header Host $host;
    }

    # Other directives
}

</code></pre>

<p><strong>5.</strong> Renew certificate every 2 month at 01:30 of first day of the month</p>

<p>Add to crontab:</p>

<pre><code>30 01 01 */2 * /usr/local/bin/lego -d example.org -d www.example.org -m cert-owner@example.org -a --path=/etc/pki/tls/lego --http=:81 --tls=:444 renew &amp;&amp; /usr/sbin/nginx -s reload
</code></pre>

<p>Links:</p>

<ul>
<li><a href="https://github.com/xenolf/lego">Let&rsquo;s Encrypt client and ACME library written in Go</a></li>
<li><a href="https://code.kuederle.com/letsencrypt/">LET’S ENCRYPT WITH LEGO AND NGINX</a></li>
<li><a href="https://raymii.org/s/snippets/CentOS_5_CA_Certificate_Bundle_Update.html">CentOS 5 CA Certificate Bundle Update</a></li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/09/07/windows-backup/">
                    Выбор простого бэкапа для Windows
                </a>
            </h1>

            <span class="post-date">2016-09-07</span>

            

<p>Доступные и функциональные системы бэкапа под Windows.</p>

<p>Требования:</p>

<ul>
<li>Основное - использование жестких или символьных ссылок для дедупликации содержимого архива.</li>
<li>Дополнительное - использование VSS (Volume Shadow Copy Service) для предварительного создания снэпшота.</li>
</ul>

<p>Не рассматриваются сложные распределенные (и дорогие) системы бэкапа. Один компьютер, одна программа или скрипт.</p>

<h3 id="dublicati-http-www-duplicati-com:0a283e5b4c781814abe20e36e5fd4350"><a href="http://www.duplicati.com/">Dublicati</a></h3>

<p>Duplicati is a free backup client that securely stores encrypted, incremental, compressed backups on cloud storage services and remote file servers. It works with Amazon S3, Windows Live SkyDrive, Google Drive (Google Docs), Rackspace Cloud Files or WebDAV, SSH, FTP (and many more).</p>

<p>Рассматривалась версия 1.3.4.</p>

<p>Особенности:</p>

<ul>
<li>архив - zip-файл.</li>
</ul>

<p>Преимущества:</p>

<ul>
<li>бесплатность;</li>
<li>кроссплатформенность (требуются .NET 2.0+ или Mono);</li>
<li>полные и инкрементальные бэкапы;</li>
<li>есть возможность шифрования архивов;</li>
<li>используется VSS;</li>
<li>есть русский язык;</li>
<li>есть мастер восстановления.</li>
</ul>

<p>Недостатки:</p>

<ul>
<li>корявый интерфейс;</li>
<li>файловые ссылки не используются;</li>
<li>наглядность при просмотре архивов отсутствует;</li>
<li>субъективно низкая скорость работы.</li>
</ul>

<h3 id="cobian-backup-http-www-cobiansoft-com:0a283e5b4c781814abe20e36e5fd4350"><a href="http://www.cobiansoft.com/">Cobian Backup</a></h3>

<p>Рассматривалась версия 11.</p>

<p>Особенности:</p>

<ul>
<li>архив - каталог.</li>
</ul>

<p>Преимущества:</p>

<ul>
<li>отличный интерфейс;</li>
<li>бесплатность;</li>
<li>полные, инкрементальные и дифференциальные бэкапы;</li>
<li>есть возможность шифрования файлов в архиве (каждый файл пакуется в зашифрованный архив);</li>
<li>субъективно высокая скорость работы.</li>
<li>есть русский язык;</li>
<li>используется VSS.</li>
</ul>

<p>Недостатки:</p>

<ul>
<li>файловые ссылки не используются;</li>
<li>вообще, отличная программа, но отсутствие программы восстановления сводит все преимущества на нет - не руками же восстанавливать файлы из инкрементальных (разностных) архивов.</li>
</ul>

<h3 id="hardlink-backup-http-www-lupinho-net-hardlinkbackup:0a283e5b4c781814abe20e36e5fd4350"><a href="http://www.lupinho.net/hardlinkbackup/">Hardlink Backup</a></h3>

<p>Рассматривалась версия 2.1.1.</p>

<p>Особенности:</p>

<ul>
<li>архив - каталог.</li>
</ul>

<p>Идеальная программа - подходит и под основное, и под дополнительное требования.</p>

<p>Преимущества:</p>

<ul>
<li>отличный интерфейс;</li>
<li>используется VSS;</li>
<li>используются файловые ссылки;</li>
<li>наглядный просмотр архивов (из Проводника или программы);</li>
<li>субъективно высокая скорость работы;</li>
<li>есть возможность восстановления из программы.</li>
</ul>

<p>Недостатки:</p>

<ul>
<li>нет русского языка;</li>
<li>самый главный минус - в бесплатной версии отсутствует запуск процесса бэкапа по расписанию.</li>
<li>платная версия стоит 29 евро.</li>
</ul>

<h3 id="скрипт-roboshot-http-roboshot-sourceforge-net:0a283e5b4c781814abe20e36e5fd4350"><a href="http://roboshot.sourceforge.net/">Скрипт RoboShot</a></h3>

<p>Рассматривалась версия 0.3.</p>

<p>Особенности:</p>

<ul>
<li>написан на PowerShell;</li>
<li>для копирования использует robocopy (т.е. высокая скорость работы);</li>
<li>вроде использует VSS;</li>
<li>использует файловые ссылки.</li>
</ul>

<p>Недостатки:</p>

<ul>
<li>требует доработки напильником (например, надо править регекспы с немецкой локализации Windows на русской);</li>
<li>на мой взгляд, слишком большой объем кода.</li>
</ul>

<h3 id="комбайн-из-bat-скрипта-rsync-и-vssadmin-http-blog-jay2k1-com-2011-08-13-how-to-create-rsync-like-hard-link-backups-with-vss-on-windows:0a283e5b4c781814abe20e36e5fd4350"><a href="http://blog.jay2k1.com/2011/08/13/how-to-create-rsync-like-hard-link-backups-with-vss-on-windows/">Комбайн из bat-скрипта, rsync и vssadmin</a></h3>

<p>Недостатки:</p>

<ul>
<li>требует доработки напильником;</li>
<li>для rsync требуется cygwin, что субъективно дает просадку по скорости.</li>
</ul>

<h3 id="утилита-ln-и-скрипт-deloreancopy-http-schinagl-priv-at-nt-ln-ln-html:0a283e5b4c781814abe20e36e5fd4350"><a href="http://schinagl.priv.at/nt/ln/ln.html">Утилита LN и скрипт DeloreanCopy</a></h3>

<p>На мой взгляд, самое простое и лучшее решение, если не нужен VSS из коробки.</p>

<ul>
<li><a href="http://schinagl.priv.at/nt/hardlinkshellext/hardlinkshellext.html">Link Shell Extension</a></li>
<li><a href="http://schinagl.priv.at/nt/ln/ln.html">ln</a> - command line hardlinks</li>
</ul>

<p>DeLoreanCopy.bat требует 3 ясных параметра:</p>

<pre><code>Usage: DeLoreanCopy &lt;SourcePath&gt; &lt;DestPath&gt; (&lt;KeepMaxCopies&gt;)
SourcePath directory containing the files to be backed up
DestPath directory where &quot;DeLorean copy&quot; sets will be created
KeepMaxCopies (opt.) remove any exceeding number of DLC sets before copying
e.g. DeLoreanCopy c:\data\source c:\data\backup 90
</code></pre>

<p>Преимущества:</p>

<ul>
<li>простота;</li>
<li>бесплатность;</li>
<li>используются файловые ссылки;</li>
<li>очень просто прикручивается VSS.</li>
</ul>

<p>Создание снэпшота с помощью <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb530725(v=vs.85).aspx">vshadow</a> и запуск скрипта vss-exec-delorean.cmd:</p>

<pre><code>vshadow.exe -script=vss-setvar.cmd -exec=vss-exec-delorean.cmd c:
</code></pre>

<p>Скрипт vss-exec-delorean.cmd:</p>

<pre><code>REM
REM called from vshadow via commandline e.g
REM
REM vshadow.exe -script=vss-setvar.cmd -exec=vss-exec.cmd e:
REM
REM vss-setvar.cmd is generated by vshadow.exe
REM
call vss-setvar.cmd
REM assign a DOS device to the created snapshot
REM
dosdev x: %shadow_device_1%
REM run the intended copy job
REM
DeLoreanCopy.bat X:\Users\paul\Documents C:\backup\ 3
REM finally remove the drive letter
REM
dosdev -r -d x:
</code></pre>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/08/30/gonc/">
                    Simple Netcat tool written in Go
                </a>
            </h1>

            <span class="post-date">2016-08-30</span>

            <p>It&rsquo;s spectacularly simple to implement TCP Netcat in Go thanks to <a href="https://golang.org/pkg/io/#Copy">io.Copy</a>.</p>

<div class="highlight"><pre><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Progress</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">bytes</span> <span class="kt">uint64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TransferStreams</span><span class="p">(</span><span class="nx">con</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Progress</span><span class="p">)</span>

	<span class="c1">// Read from Reader and write to Writer until EOF</span>
	<span class="nx">copy</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">ReadCloser</span><span class="p">,</span> <span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">WriteCloser</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">r</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
			<span class="nx">w</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
		<span class="p">}()</span>
		<span class="nx">n</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
		<span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">Progress</span><span class="p">{</span><span class="nx">bytes</span><span class="p">:</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">n</span><span class="p">)}</span>
	<span class="p">}</span>

	<span class="k">go</span> <span class="nb">copy</span><span class="p">(</span><span class="nx">con</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">)</span>
	<span class="k">go</span> <span class="nb">copy</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">con</span><span class="p">)</span>

	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span>
	<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: Connection has been closed by remote peer, %d bytes has been received\n&quot;</span><span class="p">,</span> <span class="nx">con</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">(),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">bytes</span><span class="p">)</span>
	<span class="nx">p</span> <span class="p">=</span> <span class="o">&lt;-</span><span class="nx">c</span>
	<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: Local peer has been stopped, %d bytes has been sent\n&quot;</span><span class="p">,</span> <span class="nx">con</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">(),</span> <span class="nx">p</span><span class="p">.</span><span class="nx">bytes</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>But it&rsquo;s much more harder to do the same for UDP. UDP is connectionless so there is no &ldquo;streams&rdquo; that can be copied. You must tediously read data from connection to buffer and write this buffer to stdout by one goroutine. And read data from stdin and write it to connection from other goroutine.</p>

<p>Some remarks:</p>

<ul>
<li>Without streams there is no EOF so we must use some predefined disconnect sequence to terminate transfer.</li>
<li>Without established connection a listener doesn&rsquo;t know the remote peer address until actual data will be received. So listener must wait for data, then read this data and remote address with <a href="https://golang.org/pkg/net/#UDPConn.ReadFrom">*net.UDPConn.ReadFrom</a>.</li>
</ul>

<p><div class="highlight"><pre><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// BufferLimit specifies buffer size that is sufficient to</span>
	<span class="c1">// handle full-size UDP datagram or TCP segment in one step</span>
	<span class="nx">BufferLimit</span> <span class="p">=</span> <span class="mi">2</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="c1">// DisconnectSequence is used to disconnect UDP sessions</span>
	<span class="nx">DisconnectSequence</span> <span class="p">=</span> <span class="s">&quot;~.&quot;</span>
<span class="p">)</span>

<span class="c1">// Progress indicates transfer status</span>
<span class="kd">type</span> <span class="nx">Progress</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">remoteAddr</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span>
	<span class="nx">bytes</span>      <span class="kt">uint64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">TransferPackets</span><span class="p">(</span><span class="nx">con</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Progress</span><span class="p">)</span>

	<span class="c1">// Read from Reader and write to Writer until EOF.</span>
	<span class="c1">// ra is an address to whom packets must be sent in listen mode.</span>
	<span class="nx">copy</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="nx">io</span><span class="p">.</span><span class="nx">ReadCloser</span><span class="p">,</span> <span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">WriteCloser</span><span class="p">,</span> <span class="nx">ra</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">r</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
			<span class="nx">w</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
		<span class="p">}()</span>

		<span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">BufferLimit</span><span class="p">)</span>
		<span class="nx">bytes</span> <span class="o">:=</span> <span class="nb">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="kd">var</span> <span class="nx">n</span> <span class="kt">int</span>
		<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
		<span class="kd">var</span> <span class="nx">addr</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span>

		<span class="k">for</span> <span class="p">{</span>
			<span class="c1">// Read</span>
			<span class="k">if</span> <span class="nx">con</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">UDPConn</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
				<span class="nx">n</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">con</span><span class="p">.</span><span class="nx">ReadFrom</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
				<span class="c1">// In listen mode remote address is unknown until read from</span>
				<span class="c1">// connection. Inform caller function with this address.</span>
				<span class="k">if</span> <span class="nx">con</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">ra</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
					<span class="nx">ra</span> <span class="p">=</span> <span class="nx">addr</span>
					<span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">Progress</span><span class="p">{</span><span class="nx">remoteAddr</span><span class="p">:</span> <span class="nx">ra</span><span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
					<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: ERROR: %s\n&quot;</span><span class="p">,</span> <span class="nx">ra</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="p">}</span>
				<span class="k">break</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nx">DisconnectSequence</span> <span class="p">{</span>
				<span class="k">break</span>
			<span class="p">}</span>

			<span class="c1">// Write</span>
			<span class="k">if</span> <span class="nx">con</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">w</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">UDPConn</span><span class="p">);</span> <span class="nx">ok</span> <span class="o">&amp;&amp;</span> <span class="nx">con</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="c1">// Connection remote address must be nil otherwise</span>
				<span class="c1">// &quot;WriteTo with pre-connected connection&quot; will be thrown</span>
				<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">con</span><span class="p">.</span><span class="nx">WriteTo</span><span class="p">(</span><span class="nx">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">n</span><span class="p">],</span> <span class="nx">ra</span><span class="p">)</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nx">n</span><span class="p">])</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: ERROR: %s\n&quot;</span><span class="p">,</span> <span class="nx">ra</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
				<span class="k">break</span>
			<span class="p">}</span>
			<span class="nx">bytes</span> <span class="o">+=</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">Progress</span><span class="p">{</span><span class="nx">bytes</span><span class="p">:</span> <span class="nx">bytes</span><span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">ra</span> <span class="o">:=</span> <span class="nx">con</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">()</span>
	<span class="k">go</span> <span class="nb">copy</span><span class="p">(</span><span class="nx">con</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span> <span class="nx">ra</span><span class="p">)</span>
	<span class="c1">// If connection hasn&#39;t got remote address then wait for it from receiver goroutine</span>
	<span class="k">if</span> <span class="nx">ra</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">p</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span>
		<span class="nx">ra</span> <span class="p">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">remoteAddr</span>
		<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: Datagram has been received\n&quot;</span><span class="p">,</span> <span class="nx">ra</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">go</span> <span class="nb">copy</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">con</span><span class="p">,</span> <span class="nx">ra</span><span class="p">)</span>

	<span class="nx">p</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span>
	<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: Connection has been closed, %d bytes has been received\n&quot;</span><span class="p">,</span> <span class="nx">ra</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">bytes</span><span class="p">)</span>
	<span class="nx">p</span> <span class="p">=</span> <span class="o">&lt;-</span><span class="nx">c</span>
	<span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[%s]: Local peer has been stopped, %d bytes has been sent\n&quot;</span><span class="p">,</span> <span class="nx">ra</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">bytes</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</p>

<p>Links:</p>

<ul>
<li><a href="https://github.com/dddpaul/gonc">Simple Netcat tool written in Go (gonc)</a> - gonc Github project</li>
<li><a href="http://www.minaandrawos.com/2016/05/14/udp-vs-tcp-in-golang/">Implementing UDP vs TCP in Golang</a> - Golang TCP/UDP tips and tricks</li>
<li><a href="https://betabug.nl/golang-bits-and-pieces-io-with-readers-and-writers/">Golang bits and pieces: IO with readers and writers</a> - Readers and Writers everywhere</li>
<li><a href="https://medium.com/@benbjohnson/go-walkthrough-io-package-8ac5e95a9fbd">Go Walkthrough: io package</a> - Tips and bits of Go io package</li>
<li><a href="https://habrahabr.ru/post/306914/">Разбираемся в Go: пакет io</a> - Previous article translated</li>
<li><a href="https://github.com/yanzay/netcat">Simple netcat on go</a> - Another Netcat implementation</li>
<li><a href="https://www.joyent.com/blog/tcp-puzzlers">TCP Puzzlers</a> - TCP connection tricky parts</li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/08/02/docker-network-swarm-links/">
                    Docker network and Swarm mode links
                </a>
            </h1>

            <span class="post-date">2016-08-02</span>

            <p>Some useful articles &amp; videos about modern networking in Docker:</p>

<ul>
<li><a href="https://github.com/docker/libnetwork/blob/master/docs/macvlan.md">Macvlan Driver</a> - Docker Macvlan driver is out of experimental in Docker 1.12.</li>
<li><a href="http://networkstatic.net/configuring-macvlan-ipvlan-linux-networking/">Configuring Macvlan and Ipvlan Linux Networking</a> - What Docker Macvlan driver does under the hood.</li>
<li><a href="https://github.com/lowescott/2016-dnf-materials">Materials for 2016 DevOps Networking Forum (DNF) Presentation</a> - Slides about Docker networking with Ansible playbooks.</li>
<li><a href="https://habrahabr.ru/company/badoo/blog/304702/">Видео докладов с Docker митапа</a> - Особо интересен доклад Константина Назарова &ldquo;Каждому контейнеру по IP&rdquo; (на русском).</li>
</ul>

<p>Swarm mode was presented in Docker 1.12:</p>

<ul>
<li><a href="https://blog.docker.com/2016/07/docker-built-in-orchestration-ready-for-production-docker-1-12-goes-ga/">Docker Built-In Orchestration Ready For Production: Docker 1.12 Goes GA</a> - Post from Docker blog about Swarm mode release. It contains some links to the videos.</li>
<li><a href="http://blog.hypriot.com/post/more-microservice-bliss-with-docker-1-12/">More Microservices Bliss with Docker 1.12 and Swarm only</a> - Seems like <a href="https://traefik.io/">Traefik</a> can be partially replaced with Docker 1.12. routing mesh.</li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/07/15/golang-profiling-links/">
                    Golang profiling links
                </a>
            </h1>

            <span class="post-date">2016-07-15</span>

            <p>Some useful articles &amp; videos about profiling &amp; benchmarking Go programs:</p>

<ul>
<li><a href="http://lk4d4.darth.io/posts/bench/">Go Benchmarks</a> - How to write and use benchmarks</li>
<li><a href="http://dave.cheney.net/2013/07/07/introducing-profile-super-simple-profiling-for-go-programs">Introducing profile, super simple profiling for Go programs</a> - A simple way to profile an existing Go program.</li>
<li><a href="http://blog.ralch.com/tutorial/golang-performance-and-memory-analysis/">Performance and memory analysis of Golang programs</a> - Performance metrics analysis.</li>
<li><a href="http://eax.me/go-profiling/">Профилирование в Go (гостевой пост Владимира Солонина)</a> - Доступно о профилировании на русском.</li>
<li><a href="https://habrahabr.ru/company/badoo/blog/302134/">Видео докладов с Весеннего Go митапа</a> - Особо интересен доклад Марко Кеваца о профилировании (на русском).</li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/04/15/react-for-starters/">
                    Быстрое погружение в React
                </a>
            </h1>

            <span class="post-date">2016-04-15</span>

            <p>Для разогрева:</p>

<ul>
<li><a href="https://facebook.github.io/react/docs/tutorial.html">React tutorial</a></li>
<li><a href="https://ru.hexlet.io/courses/reactjs">Курс на Хекслете</a></li>
</ul>

<p>После этого более-менее должно оформиться понимание, что:</p>

<ul>
<li>React - это V в MVC;</li>
<li>основа React - это компоненты;</li>
<li>у компонента есть главный метод render(), который дергается React&rsquo;ом, когда нужно отобразить или перерисовать компонент;</li>
<li>компоненты инициализируется через properties, и хранят state;</li>
<li>компоненты пишутся на JSX - специальный синтаксис, который &ldquo;бесшовно&rdquo; внедряет HTML в JS;</li>
<li>компоненты можно связывать в иерархические структуры;</li>
<li>состояние нельзя менять напрямую, а только через специальный метод setState() - таким образом React точно узнает, что состояние изменилось и объект надо перерисовать;</li>
<li>состояние принято хранить в родительском компоненте, и передавать его в дочерние компоненты через properties.</li>
</ul>

<p>Далее надо слегка погрузиться в ECMAScript 6 aka ES2015:</p>

<ul>
<li><a href="https://learn.javascript.ru/es-modern-usage">ES-2015 сейчас</a> - введение</li>
<li><a href="https://babeljs.io/docs/learn-es2015/">Learn ES2015</a> - кратенько про отличия от ES5</li>
<li><a href="http://www.2ality.com/2012/07/esnext-classes.html">ECMAScript 6: classes</a> - новый синтаксис классов</li>
<li><a href="http://www.2ality.com/2012/04/arrow-functions.html">ECMAScript 6: arrow functions and method definitions</a> - лямбды!</li>
<li><a href="http://www.benmvp.com/learning-es6-enhanced-object-literals/">Learning ES6: Enhanced object literals</a> - less boilerplate in objects</li>
<li><a href="https://habrahabr.ru/post/262183/">React на ES6+</a> - кратко обо всем, пока не читал</li>
</ul>

<p>Теперь рекомендую форкнуть <a href="https://github.com/reactjs/react-tutorial">React tutorial</a> и поиграться с ним, например:</p>

<ul>
<li>перевести проект на Webpack для дальнейшей работы с модулями, см. <a href="https://www.twilio.com/blog/2015/08/setting-up-react-for-es6-with-webpack-and-babel-2.html">Setting up React for ES6 with Webpack and Babel</a></li>
<li>подключить live and <a href="http://gaearon.github.io/react-hot-loader/getstarted/">hot reload</a>;</li>
<li>заменить &ldquo;var&rdquo; на &ldquo;let/const&rdquo;;</li>
<li>заменить определения методов внутри объектов (Enhanced object literals);</li>
<li>заменить потенциально опасные манипуляции со сложным стейтом (объекты, массивы) с помощью <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/splice">Array.prototype.splice()</a> или <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">Array.prototype.concat()</a> на изменения с помощью идеологически верных <a href="https://facebook.github.io/react/docs/update.html">Immutability Helpers</a>;</li>
<li>заменить XHR-вызовы через jQuery на что-то более REST&rsquo;овое, например <a href="https://github.com/github/fetch">fetch API</a>.</li>
</ul>

<hr />

<p>Кракая выжимка для начала работы с Webpack:</p>

<pre><code>npm install --save react
npm install --save react-dom
npm install --save-dev webpack
npm install --save-dev babel-loader
npm install --save-dev babel-core
npm install --save-dev babel-preset-es2015
npm install --save-dev babel-preset-react
npm install --save-dev react-hot-loader
</code></pre>

<p>Для запуска webpack-dev-server надо запустить в $HOME:</p>

<pre><code>npm install webpack-dev-server
</code></pre>

<p>В этом случае webpack-dev-server будет установлен в $HOME/node_modules, и симлинк на него будет в $HOME/node_modules/.bin. Этот каталог уже можно включить в $PATH и запускать webpack и webpack-dev-server из любого места.</p>

<p>Типовое содержимое webpack.config.js:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./public/scripts/example.js&#39;</span><span class="p">,</span>
  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">path</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/public/build&quot;</span><span class="p">,</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;bundle.js&#39;</span>
  <span class="p">},</span>
  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">loaders</span><span class="o">:</span> <span class="p">[{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="sr">/.jsx?$/</span><span class="p">,</span>
      <span class="nx">loaders</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;react-hot&quot;</span><span class="p">,</span> <span class="s2">&quot;babel-loader?presets[]=react,presets[]=es2015&quot;</span><span class="p">],</span>
      <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span>
    <span class="p">}]</span>
  <span class="p">},</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">HotModuleReplacementPlugin</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">NoErrorsPlugin</span><span class="p">(),</span> <span class="c1">// don&#39;t reload if there is an error</span>
  <span class="p">]</span>
<span class="p">};</span>
</code></pre></div>


<p>Теперь можно запустить <code>webpack -w</code> и, при любых изменениях js-файлов, будет автоматически пересобираться bundle.js. Reload в браузере все-таки придется сделать. Полноценный hot&amp;live reload можно организовать только с помощью webpack-dev-server.</p>

<hr />

<p>Про модули:</p>

<ul>
<li><a href="http://frontender.info/es6-modules/">Модули в ECMAScript 6: будущее уже сейчас</a></li>
<li><a href="http://www.2ality.com/2015/12/babel-commonjs.html">Babel and CommonJS modules</a></li>
<li><a href="http://frontender.info/packing-the-web-like-a-boss/">Пакуем как боги</a></li>
<li><a href="https://habrahabr.ru/post/250103/">Как мы готовим React, Require и Backbone</a></li>
<li><a href="https://medium.com/@rajaraodv/webpack-the-confusing-parts-58712f8fcad9#.7ffl30blv">Webpack — The Confusing Parts</a></li>
</ul>

<p>Про компоненты:</p>

<ul>
<li><a href="https://facebook.github.io/react/docs/reusable-components.html">Reusable Components</a> - пока не читал</li>
</ul>

<hr />

<p>Внедрение <a href="https://github.com/github/fetch">fetch API</a>:</p>

<pre><code>npm install --save whatwg-fetch
npm install --save imports-loader exports-loader
</code></pre>

<p>Остальные ссылки по fetch:</p>

<ul>
<li><a href="https://davidwalsh.name/fetch">fetch API</a></li>
<li><a href="https://habrahabr.ru/post/252941/">Введение в fetch</a></li>
<li><a href="https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/">This API is so Fetching!</a></li>
<li><a href="http://mts.io/2015/04/08/webpack-shims-polyfills/">Using webpack with shims and polyfills</a></li>
</ul>

<hr />

<p>Переходим к тяжелым упражнениям:</p>

<ul>
<li><a href="https://spring.io/guides/tutorials/react-and-spring-data-rest/">React.js and Spring Data REST</a> - мегаматериал про связку со Spring Boot</li>
</ul>

<p>Чтобы не ставить nodejs, npm и bower локально, можно использовать:</p>

<ul>
<li><a href="https://github.com/eirslett/frontend-maven-plugin">Frontend maven plugin</a> - для проектов на Java</li>
<li>Docker-образ <a href="https://github.com/DigitallySeamless/docker-nodejs-bower-grunt">Node.js w/ Bower &amp; Grunt</a> - для всего остального</li>
</ul>

<p>Но проще всего установить nodejs &amp; npm с <a href="https://nodejs.org">https://nodejs.org</a>.</p>

<p>Дополнительные компоненты:</p>

<ul>
<li><a href="https://react-bootstrap.github.io/">React-Bootstrap</a> - Bootstrap-компоненты, переписанные на React</li>
<li><a href="https://github.com/AllenFang/react-bootstrap-table">react-bootstrap-table</a> - крутая Bootstrap-compartible табличка</li>
</ul>

<p>Тестирование:</p>

<ul>
<li><a href="http://facebook.github.io/react/docs/test-utils.html">ReactTestUtils</a></li>
</ul>

<p>Просто интересные ресурсы:</p>

<ul>
<li><a href="http://geowarin.github.io/spring-boot-and-react-hot.html">Spring Boot and React hot loader</a> - пока не читал</li>
<li><a href="https://blog.risingstack.com/the-react-way-getting-started-tutorial/">The React.js Way: Getting Started Tutorial</a> - пока не читал</li>
<li><a href="https://github.com/winterbe/spring-react-example">Spring Boot React Example</a></li>
</ul>

        </div>
        
        <div class="post">
            <h1 class="post-title">
                <a href="https://dddpaul.github.io/blog/2016/03/17/linearizability-and-serializability/">
                    Linearizability, serializability, transaction isolation and consistency models
                </a>
            </h1>

            <span class="post-date">2016-03-17</span>

            <p><a href="http://www.bailis.org/blog/linearizability-versus-serializability/">Linearizability versus Serializability</a>:</p>

<blockquote>
<p><strong>Linearizability</strong> is a guarantee about single operations on single objects. It provides a real-time (i.e., wall-clock) guarantee on the behavior of a set of single operations (often reads and writes) on a single object (e.g., distributed register or data item).</p>

<p>Linearizability for read and write operations is synonymous with the term “atomic consistency” and is the “C,” or “consistency,” in Gilbert and Lynch’s proof of the CAP Theorem. We say linearizability is composable (or “local”) because, if operations on each object in a system are linearizable, then all operations in the system are linearizable.</p>

<p><strong>Serializability</strong> is a guarantee about transactions, or groups of one or more operations over one or more objects. It guarantees that the execution of a set of transactions (usually containing read and write operations) over multiple items is equivalent to some serial execution (total ordering) of the transactions.</p>

<p>Serializability is the traditional “I,” or isolation, in ACID. If users’ transactions each preserve application correctness (“C,” or consistency, in ACID), a serializable execution also preserves correctness. Therefore, serializability is a mechanism for guaranteeing database correctness.</p>
</blockquote>

<hr />

<p><a href="http://blog.acolyer.org/2016/02/26/distributed-consistency-and-session-anomalies/">Distributed Consistency and Session Anomalies</a>:</p>

<blockquote>
<p>In the database systems community, the gold standard is serializability. We’ve spent plenty of time looking at this in the last couple of days. Serializability concerns transactions that group multiple operations across potentially multiple objects. A serializable schedule is one that corresponds to some ordering of the transactions such that they happen one after the other in time (no concurrent / overlapping transactions). It’s the highest form of isolation between transactions.</p>
</blockquote>


<img src='https://dddpaul.github.io/blog//media/serializable.png'/>


<blockquote>
<p>In the distributed systems community, the gold standard is linearizability. Linearizability concerns single operations on single objects. A linearizable schedule is one where each operation appears to happen atomically at a single point in time. Once a write completes, all later reads (wall-clock time) should see the value of that write or the value of a later write. In a distributed context, we may have multiple replicas of an object’s state, and in a linearizable schedule it is as if they were all updated at once at a single point in time.</p>
</blockquote>


<img src='https://dddpaul.github.io/blog//media/linearizable.png'/>


<blockquote>
<p>Also, small correction: the “C” in ACID is the <em>assumption</em> that the application program is correct (each transaction in isolation brings the database from a correct state to another correct state), whereas the AID properties are <em>guarantees</em> provided by the database. Together they imply serializability.</p>
</blockquote>

<hr />

<p><a href="https://en.wikipedia.org/wiki/Consistency_model:">https://en.wikipedia.org/wiki/Consistency_model:</a></p>

<blockquote>
<p><strong>Strict consistency</strong> is the strongest consistency model. It requires that if a process reads any memory location, the value returned by the read operation is the value written by the most recent write operation to that location.</p>

<p>The <strong>sequential consistency</strong> model as defined by Lamport(1979) is a weaker memory model than strict consistency.</p>

<p><strong>Linearizability</strong> (also known as atomic consistency) can be defined as sequential consistency with the real-time constraint.</p>

<p><strong>Causal consistency</strong> can be considered a weakening model of sequential consistency by categorizing events into those causally related and those that are not. It defines that only write operations that are causally related must be seen in the same order by all processes.</p>
</blockquote>

<hr />

<p><a href="http://blog.acolyer.org/2016/02/24/a-critique-of-ansi-sql-isolation-levels/">A Critique of ANSI SQL Isolation Levels</a>:</p>


<img src='https://dddpaul.github.io/blog//media/ansi-sql-isolation-levels.png'/>


<hr />

<p>Other articles:</p>

<ul>
<li><a href="https://aphyr.com/posts/313-strong-consistency-models">Strong consistency models</a></li>
<li><a href="http://vladmihalcea.com/2014/09/14/a-beginners-guide-to-database-locking-and-the-lost-update-phenomena/">A beginner’s guide to database locking and the lost update phenomena</a></li>
<li><a href="http://blog.acolyer.org/2016/02/25/generalized-isolation-level-definitions/">Generalized Isolation Level Definitions</a></li>
<li><a href="http://www.postgresql.org/docs/current/static/transaction-iso.html">PostgreSQL - 13.2. Transaction Isolation</a></li>
<li><a href="https://habrahabr.ru/post/258145/">Забудьте САР теорему как более не актуальную</a></li>
</ul>

        </div>
        
    </div>


<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter34067830 = new Ya.Metrika({
                    id:34067830,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/34067830" style="position:absolute; left:-9999px;" alt="" /></div></noscript>



</body>
</html>
